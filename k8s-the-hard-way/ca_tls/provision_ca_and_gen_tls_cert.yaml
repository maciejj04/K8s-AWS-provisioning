- name: Provision CA
  shell: ./generate-ca.sh
  args:
    chdir: "{{ playbook_dir }}/ca_tls"

- name: Generate single k8s tls certificate for all clients.
  shell: ./single_k8s_tls_cert.sh --workers-ips='{{ worker_ips | join(",") }}' --masters-ips='{{ master_ips | join(",") }}' --k8s-public-ip='{{ k8s_public_host }}'
  args:
    chdir: "{{ playbook_dir }}/ca_tls"

#    - name: Generate admin client certificate
#      shell: ./generate-admin-client-certificate.sh
#
#    - name: Generate kubelet client certificates for each node
#      shell: ./generate-kubelet-client-certificates.sh -n="{{ item.nr }}" -i="{{ item.internal_ip }}" -e="{{ item.external_ip }}"
#      with_items: "{{ worker_nodes_info }}"

#    - name: Generate kube-controller-manager cert and ey
#      shell: ./generate-kube-controller-manager-cert-and-key.sh
#
#    - name: Generate scheduler client certificate
#      shell: ./scheduler-client-certificate.sh
#
#    - name: Generate api-server certificate
#      shell: ./generate-api-server-certificate.sh --k8s-public-adress="{{ k8s_public_adress }}" --hostnames="{{ hosts_all }}"



# TODO: Add task to archive secrets for cluster.